<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE-Deno-Client ・ API Test</title>
</head>

<body>
    <style>
        .out {
            max-width: 98%;
            width: 98%;
            height: 90vh;
        }

        textarea {
            max-width: 98%;
            width: 98%;
            height: 100px;
        }

        input {
            max-width: 98%;
            width: 98%;
        }
    </style>

    <h3>Account</h3>
    <p>authToken</p>
    <input type="text" id="auth" value="eyJ...">
    <p>device-name</p>
    <input type="text" id="device" value="DESKTOPWIN">
    <p>Login</p>
    <button type="button" onclick="create()">Login</button>
    <h3>ツール</h3>
    <h5>ticket→squareMid</h5>
    <p>ticket:<input type="text" id="ticket" value="7Qk6whxscVanCRV7Gn8kDI6s0TmxJIpxbo2z8Q"></p>
    <button type="button" onclick="ticket()">Run</button>
    <p>response</p>
    <textarea id="ticketRes"></textarea>

    <h5>参加オプ一覧</h5>
    <button type="button" onclick="joined()">Run</button>
    <p>response</p>
    <textarea id="joinedRes"></textarea>

    <h5>再参加禁止リスト取得</h5>
    <p>sid:<input type="text" id="bansid" value="sxxxxx"></p>
    <button type="button" onclick="banlist()">Run</button>
    <p>response</p>
    <textarea id="banlistRes"></textarea>

    <script src="./script.js"></script>
    <script>
        if (localStorage.getItem("auth")) {
            document.getElementById("auth").value = localStorage.getItem("auth")
        } if (localStorage.getItem("device")) {
            document.getElementById("device").value = localStorage.getItem("device")
        }
        var Account;
        const create = async () => {
            try { Account.closeSocket() } catch { }
            Account = new LineTCompactSocket("/SQ1", document.getElementById("auth").value, document.getElementById("device").value)
        }

        const ticket = async () => {
            if (Account) {
                localStorage.setItem("auth", document.getElementById("auth").value)
                localStorage.setItem("device", document.getElementById("device").value)
                let v = { invitationTicket: document.getElementById("ticket").value }
                let n = "findSquareByInvitationTicket"
                let tjson = await Account.postRequestAndGetResponse(v, n)
                document.getElementById("ticketRes").value = JSON.stringify(tjson, null, 2)
            } else {
                alert("click [Login] first")
            }
        }
        const joined = async () => {
            if (Account) {
                localStorage.setItem("auth", document.getElementById("auth").value)
                localStorage.setItem("device", document.getElementById("device").value)
                let v = { limit: 100 }
                let n = "getJoinedSquares"
                let tjson = await Account.postRequestAndGetResponse(v, n)
                document.getElementById("joinedRes").value = JSON.stringify(tjson, null, 2)
            } else {
                alert("click [Login] first")
            }
        }
        const banlist = async () => {
            if (Account) {
                localStorage.setItem("auth", document.getElementById("auth").value)
                localStorage.setItem("device", document.getElementById("device").value)
                let v = {
                    "squareMid": document.getElementById("bansid").value,
                    "searchOption": {
                        "membershipState": 6
                    },
                    "limit": 200
                }
                let n = "searchSquareMembers"
                let tjson = await Account.postRequestAndGetResponse(v, n)
                document.getElementById("banlistRes").value = JSON.stringify(tjson, null, 2)
            } else {
                alert("click [Login] first")
            }
        }
    </script>
</body>

</html>